<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ملحق عقد - شركة دال سين لتقنية المعلومات</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      background: #f9f9f9;
      color: #333;
      line-height: 1.6;
    }
    h1, h2, h3 {
      margin-top: 1.2em;
      margin-bottom: 0.6em;
      color: #444;
    }
    label {
      display: inline-block;
      margin-bottom: 0.3em;
      font-weight: bold;
    }
    input[type="text"], input[type="number"], input[type="date"],
    select, textarea {
      width: 100%;
      padding: 6px;
      margin-bottom: 10px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    textarea {
      min-height: 80px;
    }
    fieldset {
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 15px;
      margin-bottom: 20px;
      background: #fff;
    }
    legend {
      font-weight: bold;
      padding: 0 5px;
    }
    .readonly {
      background-color: #eee;
    }
    .flex-container {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .flex-item {
      flex: 1;
      min-width: 250px;
    }
    .result-box {
      background: #fcfcfc;
      border: 1px solid #ccc;
      padding: 15px;
      margin-top: 15px;
    }
    .btn {
      padding: 10px 20px;
      background: #1c87c9;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
    }
    .btn:hover {
      background: #155d81;
    }
  </style>
</head>
<body>

  <h1>ملحق عقد - شركة دال سين لتقنية المعلومات</h1>

  <!-- بيانات الطرف الأول (ثابتة) -->
  <fieldset>
    <legend>بيانات الطرف الأول (شركة دال سين لتقنية المعلومات)</legend>
    <div class="flex-container">
      <div class="flex-item">
        <label>الاسم القانوني للشركة:</label>
        <input type="text" value="شركة دال سين لتقنية المعلومات" class="readonly" readonly />
      </div>
      <div class="flex-item">
        <label>السجل التجاري:</label>
        <input type="text" value="1234567890" class="readonly" readonly />
      </div>
      <div class="flex-item">
        <label>العنوان:</label>
        <input type="text" value="الرياض، المملكة العربية السعودية" class="readonly" readonly />
      </div>
      <div class="flex-item">
        <label>أرقام التواصل:</label>
        <input type="text" value="011-1234567" class="readonly" readonly />
      </div>
      <div class="flex-item">
        <label>بريد إلكتروني رسمي:</label>
        <input type="text" value="info@dal-seen.com" class="readonly" readonly />
      </div>
    </div>
  </fieldset>

  <!-- بيانات الطرف الثاني (قابلة للتعديل) -->
  <fieldset>
    <legend>بيانات الطرف الثاني (التاجر / المستفيد)</legend>
    <div class="flex-container">
      <div class="flex-item">
        <label for="secondPartyName">الاسم القانوني:</label>
        <input type="text" id="secondPartyName" placeholder="مثال: شركة ألف للتجارة" />
      </div>
      <div class="flex-item">
        <label for="secondPartyCR">السجل التجاري:</label>
        <input type="text" id="secondPartyCR" placeholder="مثال: 9876543210" />
      </div>
      <div class="flex-item">
        <label for="secondPartyAddress">العنوان:</label>
        <input type="text" id="secondPartyAddress" placeholder="مثال: جدة، المملكة العربية السعودية" />
      </div>
      <div class="flex-item">
        <label for="secondPartyPhone">أرقام التواصل:</label>
        <input type="text" id="secondPartyPhone" placeholder="مثال: 012-3456789" />
      </div>
      <div class="flex-item">
        <label for="secondPartyEmail">البريد الإلكتروني:</label>
        <input type="text" id="secondPartyEmail" placeholder="مثال: info@alif.com" />
      </div>
    </div>
  </fieldset>

  <!-- مدة الاشتراك وتاريخ السريان -->
  <fieldset>
    <legend>مدة الاشتراك وتاريخ السريان</legend>
    <div class="flex-container">
      <!-- تاريخ البداية: ثابت من تاريخ الدخول -->
      <div class="flex-item">
        <label for="startDate">تاريخ البداية:</label>
        <input type="date" id="startDate" class="readonly" readonly />
      </div>
      <!-- تحديد المدة (سنة أو سنتان) -->
      <div class="flex-item">
        <label for="duration">المدة:</label>
        <select id="duration">
          <option value="1">سنة واحدة</option>
          <option value="2">سنتان</option>
        </select>
      </div>
      <!-- تاريخ النهاية: يتم حسابة تلقائياً -->
      <div class="flex-item">
        <label for="endDate">تاريخ النهاية:</label>
        <input type="date" id="endDate" readonly />
      </div>
    </div>
    <p>ملاحظة: العقد يتجدد تلقائيًا لنفس المدة ما لم يتم الإشعار بعدم التجديد قبل 60 يومًا من انتهائه.</p>
  </fieldset>

  <!-- تفاصيل الباقات والرسوم -->
  <fieldset>
    <legend>تفاصيل الباقات والرسوم</legend>
    <div class="flex-container">

      <!-- نوع الباقة -->
      <div class="flex-item">
        <label for="packageType">نوع الباقة:</label>
        <select id="packageType">
          <option value="shamela">الباقة الشاملة</option>
          <option value="asasya">الباقة الأساسية</option>
        </select>
      </div>

      <!-- عدد الباقات -->
      <div class="flex-item">
        <label for="packageCount">عدد الباقات:</label>
        <input type="number" id="packageCount" value="1" min="1" />
      </div>

      <!-- طريقة الدفع -->
      <div class="flex-item">
        <label for="paymentMethod">طريقة الدفع:</label>
        <select id="paymentMethod">
          <option value="monthly">شهري</option>
          <option value="yearly">سنوي</option>
          <option value="full2years">دفعة واحدة (لسنتين)</option>
        </select>
      </div>

    </div>

    <!-- عرض التفاصيل المالية -->
    <div class="result-box">
      <p><strong>المبلغ حسب طريقة الدفع:</strong> <span id="paymentAmount">0</span></p>
      <p><strong>قيمة العقد النهائية:</strong> <span id="finalAmount">0</span></p>
    </div>
  </fieldset>

  <!-- آلية السداد -->
  <fieldset>
    <legend>آلية السداد</legend>
    <div class="flex-container">
      <div class="flex-item">
        <label for="paymentWay">اختر طريقة الدفع:</label>
        <select id="paymentWay">
          <option value="bank">حوالة بنكية</option>
          <option value="credit">بطاقة ائتمانية</option>
          <option value="cheque">شيكات</option>
          <option value="other">غير ذلك</option>
        </select>
      </div>
      <div class="flex-item">
        <label for="nextPaymentDate">تاريخ الدفع القادم / الاستحقاق:</label>
        <input type="text" id="nextPaymentDate" placeholder="مثال: بداية كل شهر / سنويًا ..." />
      </div>
    </div>
    <p>سيتم استعراض المبلغ الدوري أو الإجمالي ضمن البيانات أعلاه أو في ملخص العقد.</p>
  </fieldset>

  <!-- خدمة التدريب (إن وجدت) -->
  <fieldset>
    <legend>خدمة التدريب (اختياري)</legend>
    <div class="flex-container">
      <div class="flex-item">
        <label for="freeSessions">عدد الجلسات المجانية:</label>
        <input type="number" id="freeSessions" placeholder="مثال: 2" />
      </div>
      <div class="flex-item">
        <label for="trainingType">نوع الجلسات المجانية:</label>
        <input type="text" id="trainingType" placeholder="مثال: تدريب على استخدام النظام" />
      </div>
      <div class="flex-item">
        <label for="paidTrainingDetails">تفاصيل التدريب المدفوع (إن تجاوز الحد المجاني):</label>
        <input type="text" id="paidTrainingDetails" placeholder="مثال: 200 ريال للجلسة الإضافية" />
      </div>
    </div>
  </fieldset>

  <!-- بيانات التواصل والإشعارات -->
  <fieldset>
    <legend>بيانات التواصل والإشعارات</legend>
    <p>يجب على الطرفين تحديث بيانات التواصل (البريد الإلكتروني، أرقام الهاتف، العنوان) في حال طرأ أي تغيير.</p>
  </fieldset>

  <!-- بنود/شروط إضافية -->
  <fieldset>
    <legend>بنود أو شروط إضافية</legend>
    <textarea id="additionalTerms" placeholder="أضف أي بنود إضافية..."></textarea>
  </fieldset>

  <!-- التوقيع وسريان المفعول -->
  <fieldset>
    <legend>التوقيع وسريان المفعول</legend>
    <div class="flex-container">
      <div class="flex-item">
        <label for="signerName1">اسم الموقّع (الطرف الأول):</label>
        <input type="text" id="signerName1" value="مدير شركة دال سين" />
      </div>
      <div class="flex-item">
        <label for="signerStamp1">الختم (إن وجد):</label>
        <input type="text" id="signerStamp1" placeholder="ختم الشركة" />
      </div>
    </div>
    <div class="flex-container">
      <div class="flex-item">
        <label for="signerName2">اسم الموقّع (الطرف الثاني):</label>
        <input type="text" id="signerName2" />
      </div>
      <div class="flex-item">
        <label for="signerStamp2">الختم (إن وجد):</label>
        <input type="text" id="signerStamp2" placeholder="ختم الشركة/المؤسسة" />
      </div>
    </div>
    <div>
      <label for="signDate">تاريخ التوقيع:</label>
      <input type="date" id="signDate" />
    </div>
    <p>هذا الملحق يُعدّ جزءًا لا يتجزّأ من الاتفاقية الأصلية ومتمّمًا لبنودها.</p>
  </fieldset>

  <!-- المخرجات النهائية (نموذج الطباعة أو العرض) -->
  <fieldset>
    <legend>المخرجات النهائية</legend>
    <p>عند إتمام إدخال جميع البيانات، يمكن معاينة الملحق كاملاً والضغط على زر الطباعة / حفظ PDF.</p>
    <button class="btn" onclick="printContract()">طباعة / تصدير PDF</button>
  </fieldset>

  <!-- شيفرة جافاسكربت -->
  <script>
    // نضع تاريخ اليوم في تاريخ البداية ويكون للقراءة فقط
    window.addEventListener("load", () => {
      const today = new Date();
      document.getElementById("startDate").value = formatDate(today);
      // حساب تاريخ النهاية فورًا لأول مرة
      calculateEndDate();
      // حساب الرسوم فورًا
      calculateFees();
      // جعل تاريخ التوقيع افتراضيًا أيضًا
      document.getElementById("signDate").value = formatDate(today);
    });

    // ربط تغييرات "المدة" و"طريقة الدفع" و"عدد الباقات" ونوع الباقة بالحسابات
    document.getElementById("duration").addEventListener("change", () => {
      calculateEndDate();
      calculateFees();
    });
    document.getElementById("packageType").addEventListener("change", calculateFees);
    document.getElementById("packageCount").addEventListener("change", calculateFees);
    document.getElementById("paymentMethod").addEventListener("change", calculateFees);

    // حساب تاريخ النهاية
    function calculateEndDate() {
      const startInput = document.getElementById("startDate");
      const endInput = document.getElementById("endDate");
      const durationSelect = document.getElementById("duration");

      if(!startInput.value) {
        endInput.value = "";
        return;
      }

      const startDate = new Date(startInput.value);
      const years = parseInt(durationSelect.value);

      // إضافة عدد السنوات
      const endYear = startDate.getFullYear() + years;
      const endMonth = startDate.getMonth(); // 0-11
      const endDay = startDate.getDate();

      // إنشاء كائن التاريخ النهائي
      const endDateObj = new Date(endYear, endMonth, endDay);
      endInput.value = formatDate(endDateObj);
    }

    // تنسيق التاريخ إلى الصيغة YYYY-MM-DD
    function formatDate(dateObj) {
      const year = dateObj.getFullYear();
      let month = dateObj.getMonth() + 1; // تبدأ من 0
      let day = dateObj.getDate();
      if(month < 10) month = "0" + month;
      if(day < 10) day = "0" + day;
      return `${year}-${month}-${day}`;
    }

    // جدول أسعار الباقات (لكل باقة الأسعار حسب المدة وطريقة الدفع)
    const prices = {
      shamela: {
        1: { // سنة واحدة
          monthly: 249,
          yearly: 249 * 12,
          full2years: 0 // غير منطقي لسنة واحدة
        },
        2: { // سنتان
          monthly: 189,
          yearly: 189 * 12,
          full2years: 189 * 24
        }
      },
      asasya: {
        1: { // سنة واحدة
          monthly: 219,
          yearly: 219 * 12,
          full2years: 0
        },
        2: { // سنتان
          monthly: 169,
          yearly: 169 * 12,
          full2years: 169 * 24
        }
      }
    };

    // دالة لحساب الرسوم وإظهارها
    function calculateFees() {
      const duration = parseInt(document.getElementById("duration").value); // 1 or 2
      const packageType = document.getElementById("packageType").value; // shamela / asasya
      const packageCount = parseInt(document.getElementById("packageCount").value) || 1;
      const paymentMethod = document.getElementById("paymentMethod").value; // monthly/yearly/full2years

      let pricePerPackage = 0;  // المبلغ حسب طريقة الدفع
      let displayAmount = 0;    // المبلغ الذي سنعرضه مباشرة (شهري/سنوي/دفعة سنتين)
      let finalContractValue = 0; // قيمة العقد النهائية

      // جلب السعر من الجدول حسب نوع الباقة والمدة
      pricePerPackage = prices[packageType][duration][paymentMethod];

      // في حالة monthly أو yearly قد تكون قيمة pricePerPackage = 0 لو كانت غير متاحة، لذا نأخذ من الكائن المناسب
      // لكن في الجداول الحالية وضعنا الأرقام بشكل مباشر
      // إذا كانت المدّة سنة واختر user "full2years" => pricePerPackage = 0 => تعني "غير متاح"

      if (paymentMethod === "monthly") {
        // المبلغ الشهري = السعر الشهري × عدد الباقات
        displayAmount = prices[packageType][duration].monthly * packageCount;

        // قيمة العقد النهائية = (المبلغ الشهري × 12) إذا سنة واحدة، أو × 24 إذا سنتان
        if (duration === 1) {
          finalContractValue = displayAmount * 12;
        } else if (duration === 2) {
          finalContractValue = displayAmount * 24;
        }

        // نعرض النص
        document.getElementById("paymentAmount").innerText = `${displayAmount} ريال/شهر`;
        document.getElementById("finalAmount").innerText = `${finalContractValue} ريال طوال مدة العقد`;
      }
      else if (paymentMethod === "yearly") {
        // المبلغ السنوي = السعر السنوي × عدد الباقات
        displayAmount = prices[packageType][duration].yearly * packageCount;

        // قيمة العقد النهائية = المبلغ السنوي * عدد السنوات (1 أو 2)
        if (duration === 1) {
          finalContractValue = displayAmount;
        } else if (duration === 2) {
          // مدة سنتين => ندفع "المبلغ السنوي" كل سنة، لمجموع سنتين
          finalContractValue = displayAmount * 2;
        }

        document.getElementById("paymentAmount").innerText = `${displayAmount} ريال/سنة`;
        document.getElementById("finalAmount").innerText = `${finalContractValue} ريال طوال مدة العقد`;
      }
      else if (paymentMethod === "full2years") {
        // دفعة واحدة للسنتين
        // إذا كانت المدّة سنتان => نستخدم السعر المحدد
        if (duration === 2) {
          displayAmount = prices[packageType][2].full2years * packageCount;
          finalContractValue = displayAmount; // لأنها دفعة واحدة كاملة

          document.getElementById("paymentAmount").innerText = `${displayAmount} ريال (دفعة واحدة لسنتين)`;
          document.getElementById("finalAmount").innerText = `${finalContractValue} ريال طوال مدة العقد`;
        }
        else {
          // إذا كانت المدّة سنة واختر المستخدم دفعة سنتين => غير متاح
          document.getElementById("paymentAmount").innerText = `غير متاح`;
          document.getElementById("finalAmount").innerText = `--`;
        }
      }
    }

    // دالة الطباعة / التصدير
    function printContract() {
      window.print();
    }

  </script>
</body>
</html>
